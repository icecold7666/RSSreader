# RSS 阅读器 App 功能模块详细说明

## 一、核心功能模块（必须实现）
### 1. RSS 源管理模块
| 子功能 | 功能描述 | 交互逻辑 | 技术实现要点 |
|--------|----------|----------|--------------|
| 1.1 添加 RSS 源 | 支持手动输入 RSS 源名称、URL，选择分类，验证源有效性后添加 | 1. 用户输入名称/URL → 2. 点击「验证」按钮 → 3. 验证通过（提示「源有效」）/失败（提示「地址错误/无法访问」） → 4. 选择分类 → 5. 点击「添加」→ 6. 提示「添加成功」并返回列表 | 1. 封装 `RssParserUtils` 实现 URL 有效性校验；<br>2. Room 存储 `RssSource` 实体（id/名称/URL/分类ID/启用状态/最后刷新时间）；<br>3. 非阻塞式网络请求（Coroutine + Retrofit），避免 UI 卡顿；<br>4. 输入校验（URL 格式、名称非空） |
| 1.2 编辑 RSS 源 | 支持修改 RSS 源名称、分类、启用/禁用状态 | 1. 长按/点击「编辑」→ 2. 编辑弹窗/页面 → 3. 保存修改 → 4. 列表实时刷新 | 1. ViewModel 维护编辑状态；<br>2. Room 更新操作，带事务保证；<br>3. 禁用的源不参与自动刷新 |
| 1.3 删除 RSS 源 | 支持单条/批量删除 RSS 源，删除时连带删除该源的所有文章 | 1. 单条删除：长按 → 选择「删除」→ 确认弹窗 → 删除；<br>2. 批量删除：进入批量模式 → 勾选源 → 点击「删除」→ 确认 → 批量删除 | 1. Room 级联删除（删除源时自动删除关联文章）；<br>2. 批量操作封装为 `BatchDeleteUseCase`；<br>3. 删除前二次确认，防止误操作 |
| 1.4 分类管理 | 支持创建/编辑/删除 RSS 源分类，分类下可查看所有源 | 1. 创建：点击「新建分类」→ 输入名称/选择图标 → 保存；<br>2. 编辑：修改分类名称/图标；<br>3. 删除：删除分类时可选择「将源迁移至其他分类」或「一并删除源」 | 1. Room 设计 `Category` 实体（id/名称/图标/排序）；<br>2. 分类排序支持拖拽调整；<br>3. 删除分类时的事务处理（避免数据丢失） |

### 2. RSS 内容获取与解析模块
| 子功能 | 功能描述 | 交互逻辑 | 技术实现要点 |
|--------|----------|----------|--------------|
| 2.1 手动刷新 | 支持单源刷新/全部分类刷新/全部源刷新 | 1. 单源刷新：列表页点击「刷新」按钮 → 显示加载动画 → 刷新完成后更新文章数；<br>2. 批量刷新：点击「批量刷新」→ 选择范围 → 后台刷新，状态栏显示进度 | 1. 封装 `RssRefreshUseCase`，支持单源/批量刷新；<br>2. 刷新防抖（避免短时间重复刷新）；<br>3. 网络异常时提示「刷新失败，点击重试」 |
| 2.2 自动刷新 | 支持设置刷新间隔（1小时/3小时/6小时/12小时/24小时），后台自动刷新 | 1. 设置页开启「自动刷新」→ 选择间隔 → 后台定时执行；<br>2. 无网时暂存任务，联网后自动执行；<br>3. 仅刷新「启用状态」的源 | 1. 使用 WorkManager 实现定时任务；<br>2. 监听网络状态（ConnectivityManager）；<br>3. 后台刷新时避免唤醒 UI，仅更新数据库 |
| 2.3 RSS 解析 | 支持主流 RSS 格式（RSS 2.0/Atom 1.0），解析标题/正文/发布时间/作者/链接 | 无直接交互，解析失败时在列表页提示「该源解析失败」 | 1. 封装 `RssParser` 接口，分别实现 `Rss20Parser`/`Atom10Parser`；<br>2. 解析失败时记录错误日志，便于排查；<br>3. 兼容非标准 RSS 源（容错处理，提取核心字段） |
| 2.4 内容去重 | 避免重复拉取同一篇文章（按标题+链接+发布时间去重） | 无交互，自动去重 | 1. Room 给「标题+链接」加联合唯一索引；<br>2. 解析后先校验是否已存在，再入库 |

### 3. 文章展示与阅读模块
| 子功能 | 功能描述 | 交互逻辑 | 技术实现要点 |
|--------|----------|----------|--------------|
| 3.1 文章列表 | 按「全部/分类/单源」展示文章，支持下拉刷新/上拉加载更多 | 1. 切换分类/源 → 列表加载对应文章；<br>2. 下拉刷新：触发该分类/源的手动刷新；<br>3. 上拉加载：加载更早的文章（分页） | 1. Compose LazyColumn 实现高性能列表；<br>2. 分页加载（Room 按发布时间分页查询）；<br>3. 列表状态管理（加载中/空/错误/完成）；<br>4. 文章项显示「标题/摘要/发布时间/源名称/是否已读/是否收藏」 |
| 3.2 文章详情 | 渲染文章标题/正文/图片/链接，支持跳转原文、调整排版 | 1. 点击文章项 → 进入详情页；<br>2. 正文支持图文混排、链接点击跳转浏览器；<br>3. 底部工具栏：收藏/分享/字体调整/离线下载 | 1. 使用 Compose WebView/自定义文本组件渲染正文；<br>2. 图片懒加载，避免内存溢出；<br>3. 链接点击拦截，支持「在App内打开/浏览器打开」 |
| 3.3 已读/未读标记 | 未读文章高亮显示，支持手动标记已读/未读、批量标记 | 1. 阅读后自动标记为已读；<br>2. 手动标记：长按文章 → 选择「标记已读/未读」；<br>3. 批量标记：批量模式下勾选文章 → 标记为已读/未读 | 1. Room `Article` 实体添加 `isRead` 字段；<br>2. 批量标记封装为 `BatchMarkReadUseCase`；<br>3. 未读文章数在分类/源列表旁显示角标 |
| 3.4 文章搜索 | 支持按标题/正文/源名称搜索文章，支持筛选（时间/已读/收藏） | 1. 顶部搜索框输入关键词 → 实时显示搜索结果；<br>2. 筛选：按「全部/今天/本周/本月」「已读/未读」「收藏/非收藏」筛选 | 1. Room FTS4 全文搜索（提升搜索速度）；<br>2. 搜索防抖（输入停止 500ms 后执行）；<br>3. 搜索结果按「相关性/发布时间」排序 |

## 二、扩展功能模块（建议实现）
### 1. 收藏与离线阅读模块
| 子功能 | 功能描述 | 交互逻辑 | 技术实现要点 |
|--------|----------|----------|--------------|
| 1.1 文章收藏 | 支持收藏/取消收藏文章，收藏列表独立展示 | 1. 详情页点击「收藏」按钮 → 按钮高亮；<br>2. 收藏列表：按时间/源名称筛选、搜索 | 1. Room `Article` 实体添加 `isCollected` 字段；<br>2. 收藏列表单独封装 `CollectViewModel`；<br>3. 收藏状态实时同步到文章列表 |
| 1.2 离线下载 | 支持单篇/批量下载文章（含图片），离线时可阅读 | 1. 详情页点击「下载」→ 显示下载进度；<br>2. 批量下载：列表页勾选文章 → 点击「下载」；<br>3. 离线列表：展示已下载文章，支持删除缓存 | 1. 封装 `FileDownloadManager`，下载文章正文+图片到本地；<br>2. Room `Article` 实体添加 `cachePath` 字段；<br>3. 下载进度通过 Flow 实时更新；<br>4. 离线阅读时优先加载本地缓存 |
| 1.3 缓存管理 | 支持清理全部离线缓存、按源清理缓存，显示缓存大小 | 1. 设置页 → 「缓存管理」→ 显示总缓存大小；<br>2. 选择「清理全部」/「按源清理」→ 确认后删除文件+更新数据库 | 1. 封装 `CacheManager`，计算缓存大小、删除缓存文件；<br>2. 清理后更新 Room 中 `cachePath` 字段为 null；<br>3. 清理前提示「清理后将无法离线阅读已下载文章」 |

### 2. 个性化设置模块
| 子功能 | 功能描述 | 交互逻辑 | 技术实现要点 |
|--------|----------|----------|--------------|
| 2.1 阅读设置 | 支持调整字体大小、行间距、背景色（日间/夜间/跟随系统） | 1. 设置页 → 「阅读设置」→ 滑动调整字体大小/行间距；<br>2. 夜间模式：开关切换/跟随系统；<br>3. 更改后实时生效（无需重启） | 1. 使用 `DataStore` 存储设置项（替代 SP，更适合 Compose）；<br>2. 阅读样式封装为 `ReadingStyle` 数据类；<br>3. 夜间模式适配 Material3 主题 |
| 2.2 刷新设置 | 支持开启/关闭自动刷新、调整刷新间隔、设置仅WiFi下刷新 | 1. 设置页 → 「刷新设置」→ 开关自动刷新、选择间隔、开关「仅WiFi刷新」；<br>2. 更改后立即生效，重启定时任务 | 1. DataStore 存储刷新配置；<br>2. 更改间隔后取消原有 WorkManager 任务，创建新任务；<br>3. 网络类型判断（WiFi/移动网络） |
| 2.3 通知设置 | 支持开启/关闭「新文章通知」，选择通知时段、通知源范围 | 1. 设置页 → 「通知设置」→ 开关通知、选择时段（如 9:00-22:00）、选择「全部源/指定分类」；<br>2. 新文章达到时推送通知，点击跳转对应文章 | 1. 使用 NotificationManager 实现本地通知；<br>2. 通知时段判断，避免夜间打扰；<br>3. 通知点击跳转通过 PendingIntent 实现 |

### 3. 辅助功能模块
| 子功能 | 功能描述 | 交互逻辑 | 技术实现要点 |
|--------|----------|----------|--------------|
| 3.1 文章分享 | 支持将文章标题+链接分享到微信/QQ/微博/复制链接 | 1. 详情页点击「分享」→ 弹出分享面板 → 选择分享渠道；<br>2. 支持「复制链接」「生成图片分享」 | 1. 封装 `ShareManager`，调用系统分享接口；<br>2. 生成分享图片：Compose 绘制文章卡片 → 保存为图片 → 分享 |
| 3.2 RSS 源导入/导出 | 支持导出已订阅的 RSS 源（OPML 格式）、导入 OPML 文件 | 1. 设置页 → 「导入/导出」→ 导出：生成 OPML 文件保存到本地；<br>2. 导入：选择本地 OPML 文件 → 解析后批量添加源 | 1. 封装 `OpmlParser`，支持 OPML 格式解析/生成；<br>2. 文件选择使用 MediaStore/系统文件选择器；<br>3. 导入时自动去重，避免重复添加 |
| 3.3 异常恢复 | 支持「恢复默认设置」「重建数据库」，解决数据异常问题 | 1. 设置页 → 「高级设置」→ 「恢复默认设置」（保留源和文章）/「重建数据库」（清空所有数据）；<br>2. 操作前二次确认 | 1. 重建数据库：删除 Room 数据库文件 → 重新初始化；<br>2. 恢复默认设置：重置 DataStore 中的设置项为默认值 |

## 三、非功能需求（保障 App 质量）
| 维度 | 详细要求 | 实现要点 |
|------|----------|----------|
| 性能 | 1. 列表滑动流畅（帧率 ≥ 60）；<br>2. 首次加载时间 ≤ 2s；<br>3. 解析 100 条 RSS 内容 ≤ 3s；<br>4. 内存占用 ≤ 200MB | 1. LazyColumn 分页加载、复用 Item；<br>2. 图片缓存（Glide/Coil）、懒加载；<br>3. 解析逻辑放在子线程，避免阻塞主线程；<br>4. 定期清理无用缓存，避免内存泄漏 |
| 兼容性 | 1. 支持 Android 8.0（API 26）及以上；<br>2. 适配主流分辨率（手机/平板）；<br>3. 适配深色模式/系统字体大小 | 1. 权限适配（Android 13+ 通知权限、文件权限）；<br>2. Compose 自适应布局（dp/sp 单位、ConstraintLayout）；<br>3. 字体大小跟随系统设置 |
| 稳定性 | 1. 崩溃率 ≤ 0.1%；<br>2. 无 ANR（应用无响应）；<br>3. 网络异常/解析失败时友好提示 | 1. 全局异常捕获（CrashHandler）；<br>2. 所有网络请求/数据库操作加 try-catch；<br>3. 耗时操作（解析/下载）放在子线程；<br>4. 空数据/异常状态友好提示（无数据插图、重试按钮） |
| 可维护性 | 1. 代码分层清晰（UI/业务/数据/工具）；<br>2. 核心函数加注释；<br>3. 关键操作加日志（调试/错误） | 1. 严格遵循分层架构，禁止跨层调用；<br>2. 注释规范：函数注释说明「功能/入参/返回值/异常」；<br>3. 日志分级（Debug/Info/Error），上线后关闭 Debug 日志 |

## 总结（核心要点）
1. **核心优先级**：先实现「源管理+内容解析+文章阅读」，再扩展「收藏/离线/设置」，最后加「分享/导入导出」；
2. **用户体验**：操作流程简化（少步骤、多确认），异常状态友好提示，避免用户误操作；
3. **可维护性**：分层架构+单一职责，每个功能封装为独立 UseCase/Manager，后期加功能只需扩展，无需修改核心逻辑；
4. **性能保障**：列表分页、图片缓存、子线程处理耗时操作，避免 UI 卡顿。